<!DOCTYPE html>
<html lang="en">
    <head>
	<link rel="icon" type="image/png" href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-favicon.png">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Stratis Storage</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;print.css" media="print">
      <link rel="stylesheet" href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;poole.css">
      <link rel="stylesheet" href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;hyde.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
	  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

      

      
      
    </head>

    <body class="theme-base-10 ">
        
            <div class="sidebar">
                <div class="container ">
					<div>
						<a href="https:&#x2F;&#x2F;stratis-storage.github.io">
							<img src="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;imgs&#x2F;stratis_sidebar.png" />
						</a>
					</div>
                    <div class="sidebar-about">
                        
                            <!-- <a href="https:&#x2F;&#x2F;stratis-storage.github.io"><h1>Stratis Storage</h1></a> -->
                            
                            <p class="about lead">Easy to use local storage management for Linux.</p>
                            
                        
                    </div>

                    User Links:</br>
                    <ul class="sidebar-nav">
                        
                        
                           <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;lab.redhat.com&#x2F;stratis">Tutorial</a></li>
                        
                           <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;howto">How-To</a></li>
                        
                        
                    </ul>
                    Developer Links:</br>
                    <ul class="sidebar-nav">
                        
                        
                        <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;StratisSoftwareDesign.pdf">Software Design</a></li>
                        
                        <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;DBusAPIReference.pdf">DBUS API Reference</a></li>
                        
                        <li class="sidebar-nav-item"><a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;StratisStyleGuidelines.pdf">Programming Style Guidelines</a></li>
                        
                        
                    </ul>
                    Contact Links:</br>
                    <ul class="sidebar-nav">
                        
                        
                        <li class="sidebar-nav-item" style="display: inline-block">
						  <a href="https:&#x2F;&#x2F;github.com&#x2F;stratis-storage">
						    
							  <i class="fab fa-github"></i>
							
					      </a>
						</li>
                        
                        <li class="sidebar-nav-item" style="display: inline-block">
						  <a href="https:&#x2F;&#x2F;twitter.com&#x2F;stratisstorage">
						    
							  <i class="fab fa-twitter"></i>
							
					      </a>
						</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
                <div class="posts">
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-4-0&#x2F;">
								Stratis 2.4.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.4.0 includes two major user-visible changes:</p>
<ul>
<li>All the functionality required to boot from a Stratis-managed root
filesystem. See the prior post <a href="https://stratis-storage.github.io/stratis-rootfs/">Stratis filesystems as the root filesystem</a>
for a more detailed discussion.</li>
<li>An enhancement to existing encryption support that allows the user to
create a pool with encryption managed either by the kernel keyring or
<a href="https://github.com/latchset/clevis">Clevis</a>, and to subsequently bind an already encrypted pool using either
mechanism. Previously, the user could create an encrypted pool using the
kernel keyring only, and could bind or unbind using Clevis only.</li>
</ul>
<p>More minor user-visible changes are:</p>
<ul>
<li>An enhancment to the FetchProperties D-Bus interface in order to disclose
more information about sets of encrypted devices.</li>
<li>The <code>engine_state_report</code> key in the report interface has been stabilized
and is guaranteed to be supported in future releases.</li>
<li>A new executable, <code>stratis-predict-usage</code> to predict free space on a newly
created pool is distributed with stratisd.</li>
</ul>
<p>This release of Stratis also includes a number of significant but less
visible changes:</p>
<ul>
<li>Support for multi-threading in stratisd. The new multi-threading
implementation replaces the prior event-loop implementation. See the prior
post <a href="https://stratis-storage.github.io/multi-threading/">Multi-threading Support in stratisd</a> for a detailed discussion.</li>
<li>The management of Stratis filesystem symlinks has been simplified.
Determining the filesystem and pool name that comprise the symlink path no
longer requires communication with stratisd over the D-Bus; it is
now accomplished via standard udev-based mechanisms.</li>
<li>stratisd now emits a log message at the info level in connection with every
mutating D-Bus method call that it completes without an error.</li>
</ul>
<p>The support for migrating symlinks introduced in Stratis 2.2.0 is no longer
included in this release.</p>
<p>The ongoing and perpetual but entirely routine work of improvements to
individual log and error messages continues.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-4-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-rootfs&#x2F;">
								Stratis filesystems as the root filesystem
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>John Baublitz, Stratis Team</em></p>
<p>While Stratis unencrypted pools could previously be used as the root filesystem
for a Linux installation with proper customization of the initramfs, our most
recent feature provides all of the plumbing to fully support Stratis filesystems
as the root filesystem of a Linux installation.</p>
<h3 id="ipc">IPC</h3>
<p>Stratis relies on D-Bus for interprocess communication between the daemon and the
client. D-Bus does not currently ship in the initramfs so the first order of business
was to choose an alternate form of IPC. Because we require the ability to pass a file
descriptor from the client to the daemon, this made Unix sockets the only reasonable
transport mechanism. After evaluating several JSON RPC libraries with Unix socket
support, we decided to write a minimal RPC interface ourselves. This was due to a
few constraints:</p>
<ul>
<li>JSON RPC libraries with Unix socket support did not support setting the ancillary
data for packets required to send file descriptors.</li>
<li>The libraries had relatively complicated threading models, and we preferred to take
a simple approach of processing each new request using a Tokio task.</li>
<li>It was relatively trivial to serialize full data structures as JSON thanks to
<a href="https://github.com/serde-rs/json"><code>serde_json</code></a>.</li>
</ul>
<p>This approach proved successful and we were able to implement an IPC mechanism
that left our internal stratisd API unchanged. The alternate IPC mechanism is
distributed in a separate pair of executables, stratis-min and stratisd-min.</p>
<h3 id="support-in-the-initramfs">Support in the initramfs</h3>
<p>The next step was to integrate stratisd-min into the initramfs. This involved quite a
bit of configuration for dracut and systemd.</p>
<p>Our current model uses systemd generators that are enabled by passing information on
the kernel command line at boot to properly set up and unlock any devices that need
to be unlocked. We aim to do this in as user-friendly of a way as possible by
leveraging existing tools like Plymouth to handle prompting users for a passphrase
on the splash screen.</p>
<p>To set up the generators and necessary dependencies, we wrote two dracut modules:
stratis and stratis-clevis. stratis-clevis depends on stratis and is required for
automated unlocking using clevis.</p>
<p>The required information on the kernel command line is:</p>
<ul>
<li><code> root=[STRATIS_FS_SYMLINK]</code>: The symlink under <code>/dev/stratis</code> that corresponds to
the desired Stratis filesystem. This is required by dracut.</li>
<li><code> stratis.rootfs.pool_uuid=[POOL_UUID]</code>: The UUID of the pool that contains the
root filesystem.</li>
</ul>
<p>If the user requires networking (for example, unlocking a pool using Tang), the
parameter <code>rd.neednet=1</code> is required as well.</p>
<h3 id="testing-on-fedora-using-anaconda">Testing on Fedora using Anaconda</h3>
<p>This process was relatively simple once it came time to test with Fedora. Anaconda
provides the parameter <code>--dirinstall</code> which allows the user to install into a path
with the mounted Stratis filesystem as the root directory. It requires a bit more
configuration after the fact (manual <code>/etc/fstab</code> or <code>.mount</code> file configuration) but
works quite well.</p>
<h3 id="etc-fstab-or-mount-files"><code>/etc/fstab</code> or <code>.mount</code> files</h3>
<p>We now also provide a systemd service to manage setting up non-root filesystems in
/etc/fstab.  For devices that require a passphrase or are critical for a working
system, the following line can be used:</p>
<p><code>/dev/stratis/[STRATIS_SYMLINK] [MOUNT_POINT] xfs defaults,x-systemd.requires=stratis-fstab-setup@[POOL_UUID],x-systemd.after=stratis-fstab-setup@[POOL_UUID] 0 2</code></p>
<p>The absence of <code>nofail</code> here is due to the fact that <code>nofail</code> causes the boot to
proceed prior to a successful mount. This means that passphrase prompts
will not work properly, and most users will want critical system partitions to be
mounted successfully or else have the boot fail.</p>
<p>For devices that do not require interaction to set up, such as unencrypted devices or
devices that have Clevis bindings, and are not critical for a working system, the
following line can be optionally used:</p>
<p><code>/dev/stratis/[STRATIS_SYMLINK] [MOUNT_POINT] xfs defaults,x-systemd.requires=stratis-fstab-setup@[POOL_UUID],x-systemd.after=stratis-fstab-setup@[POOL_UUID],nofail 0 2</code></p>
<p>The addition of <code>nofail</code> here will cause mounting of this device to proceed
independently from the boot which can speed up boot times. The set up process will
continue running in the background until it either succeeds or fails.</p>
<p>Because the root filesystem is mostly set up in the initramfs, the entry is slightly
different and does not require the <code>stratis-fstab-setup</code> service. It should be:</p>
<p><code>/dev/stratis/[STRATIS_SYMLINK] / xfs defaults 0 1</code></p>
<h3 id="recovery-console">Recovery console</h3>
<p>While we mention above that stratisd could previously be used in the initramfs, there
is one major caveat: it could be started but commands could not be issued. This had
one major drawback of not allowing users to interact with stratisd in the recovery
console. D-Bus is not available in the recovery console, so the move to stratis-min
and stratisd-min now allows users to perform recovery actions in the emergency console
by starting stratisd-min and running the necessary commands using stratis-min. This
will make rescuing systems that do not boot significantly easier moving forward.</p>
<h3 id="scope-of-dracut-modules-and-systemd-service-files">Scope of dracut modules and systemd service files</h3>
<p>While our dracut modules and systemd service files are meant to work for almost all
users, they may not meet the requirements of everyone using them. We encourage those
with more advanced configurations to design their own configurations and reach out
for guidance as needed. Our configuration is also meant as a template that you can
build on!</p>
<h3 id="conclusion">Conclusion</h3>
<p>While this took quite a bit of effort to put all of the pieces together, the Linux
boot utilities had all of the features we needed to accomplish this. We're excited
for future work with other teams to make using Stratis as the root filesystem
for Linux installations even easier!</p>
<h3 id="release-version">Release version</h3>
<p>All of the utilities required for booting from a Stratis filesystem as the root
filesystem will be included in stratisd 2.4.0.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-rootfs&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;multi-threading&#x2F;">
								Multi-threading Support in stratisd
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<h1 id="introducing-support-for-multi-threading-in-stratisd">Introducing Support for Multi-threading in stratisd</h1>
<p><code>stratisd</code> is an entirely single-threaded application;
it is a daemon with a single event loop that consults a list of possible
event sources in a prescribed order, handling the events on each event
source before proceeding to the next.
The event sources are udev, device-mapper, and D-Bus events which are
handled in that order. <code>stratisd</code> can also be terminated cleanly by an
interrupt signal, which it checks for on every loop iteration.</p>
<p>Because <code>stratisd</code> is single threaded, every action taken by <code>stratisd</code> must be
completed before another action is performed. For example, if a client issues
a D-Bus message to create a filesystem, that command will be processed, the
engine will create a filesystem, and a response will be transmitted on the
D-Bus before any other action can be taken. If another D-Bus message is
received before the first is completed, that D-Bus message will then be
processed.  The engine will continue to process D-Bus messages until none are
left, preventing it from handling any other categories of signals or
events while any D-Bus messages remain.</p>
<p>For this reason, <code>stratisd</code> itself can not parallelize long-running
operations. It is well known that, for example, filesystem creation can be
time consuming, as it is necessary to write the filesystem metadata when
creating the filesystem. Ideally, <code>stratisd</code> would be able to run such time
consuming operations in parallel, initiating one operation and then
proceeding to initiate another before the first operation completes.</p>
<p>Additionally, as in the example above, if <code>stratisd</code> is continually receiving
D-Bus messages, it will not proceed to deal with a device-mapper event,
even if the device-mapper event is urgent and not in any conflict with the
D-Bus messages, for example, if it is associated with a different pool than
any D-Bus messages.</p>
<p>For these reasons, the next release introduces multi-threading capabilities
into <code>stratisd</code>. These capabilities do not solve all the problems that
multi-threading is intended to solve, but lay the essential foundation for
multi-threaded event handling.</p>
<p>We have chosen to implement multi-threading using the Rust <a href="https://tokio.rs/">tokio</a> crate.
The alternative is to use operating system threads explicitly via the
Rust standard library <a href="https://doc.rust-lang.org/std/thread/">thread</a> module. We have chosen <code>tokio</code> in order to
get the benefits of code reuse from the <code>tokio</code> runtime, and because we
expect that this choice will allow <code>stratisd</code> to operate efficiently while
consuming fewer operating system resources.</p>
<p>We have also made use of the newest version of the <a href="https://crates.io/crates/dbus">dbus</a> crate, which
includes support for multi-threading via the <a href="https://crates.io/crates/dbus-tokio/">dbus-tokio</a> crate.</p>
<h1 id="nomenclature">Nomenclature</h1>
<p>The following words have a precise definition in the context of
multi-threading:</p>
<ul>
<li>object - an instance of a Rust struct and the methods implemented for it.</li>
<li>task - A task is a program which has been designed so that it can
be run concurrently  with its fellow tasks. The multi-threaded incarnation
of <code>stratisd</code> consists of a set of tasks, some code to facilitate interactions
between the tasks, and the <code>tokio</code> runtime.</li>
<li>context - the context of a process is all the information required to
begin running the process when it resumes after having been suspended by the
operating system scheduler. A context switch is the action of storing this
information for the process being suspended and loading the information for
the process being resumed.</li>
<li>thread - a thread is a sub-division of a process. When an operating system
switches processes, a context switch is required. When an operating
system switches threads, the new thread shares much of its process' context
with the previous thread. Consequently, switching between threads, as opposed
to processes, may be an order of magnitude less expensive. All threads
belonging to a process share the same memory and may communicate via this
shared memory.</li>
<li>runtime - the <code>tokio</code> runtime manages scheduling of tasks.</li>
<li>block - a task is said to block on an operation if the task must wait
for the operation to complete and is not able to be replaced in the same
thread by another task until the operation is completed. Examples of typical
operations are I/O or network interactions. Another sort of operation is
the acquisition of a shared resource via a mutex or other synchronization
primitive.</li>
<li>blocking - a blocking task is a task that may block.</li>
<li>non-blocking - a non-blocking task is a task that does not need to wait
for any operation to complete; if it initiates an operation that may take
a while to complete, it is able to yield to another task, and may be resumed
later from the instruction where it yielded.</li>
<li>mutex - a synchronization primitive which enforces mutual exclusion. With
<code>tokio</code> the exclusion is enforced on a particular object. If a task obtains
a mutex, it has exclusive use of the object until it releases the mutex.  If
a mutex is already held by another task, a task requesting the mutex may
block or it may yield until the mutex can be obtained.</li>
<li>read/write lock - a mutex which is relaxed in so far as that it allows
multiple tasks to share an object if none mutate the object. If a task
mutates the object then it must obtain exclusive possession of the mutex.</li>
<li>lock - to enter a mutex guarding an object is synonymous with locking
an object.</li>
</ul>
<h1 id="design">Design</h1>
<p><code>stratisd</code> divides its work among a number of tasks which handle
different event sources. Some tasks are non-blocking, others are blocking
tasks. Non-blocking tasks may yield, and can share a single thread with
other non-blocking tasks. The tasks communicate using two unbounded MPSC
(Multi-Producer Single-Consumer) channels; a channel for udev events and
a channel for D-Bus updates.</p>
<h2 id="termination-variable">Termination Variable</h2>
<p>One boolean variable, <code>should_exit</code>, is shared among some of the tasks.
It is set to true only if SIGINT is detected. It is observed only by the
udev task, which checks its value on every iteration of its loop, and
immediately returns if the value is <code>true</code>. For all other tasks, termination
is handled by <code>tokio</code> constructs. The udev task requires special handling
because it does not yield and because it contains a non-terminating loop.</p>
<h2 id="the-dbus-tree">The dbus <code>tree</code></h2>
<p>The dbus tree is a data structure which contains the state of the D-Bus
layers. Access to the dbus tree is controlled by a read/write lock.</p>
<h2 id="the-stratisd-engine">The stratisd engine</h2>
<p>The <code>stratisd</code> engine is the core of the <code>stratisd</code> daemon. It manages all the
essential functionality of <code>stratisd</code>. Access to the engine is controlled
by a mutex.</p>
<h2 id="the-dbus-channel">The dbus channel</h2>
<p>The dbus channel is an unbounded multi-producer, single-consumer channel.
It carries messages instructing the DbusTreeHandler how to update the dbus
tree. The DbusTreeHandler task is the unique consumer of the messages.
The DbusConnectionHandler, which processes D-Bus messages sent by the client,
and the DbusUdevhandler, which handles udev events, may both place messages
on the dbus channel.</p>
<h2 id="the-udev-channel">The udev channel</h2>
<p>The udev channel is an unbounded multi-producer, single-consumer channel.
It carries messages about udev events to the DbusUdevHandler. There is
only one producer for this channel, the udev event handling task,
which monitors udev events and places those events on the channel.</p>
<h2 id="signal-handling-task">signal handling task</h2>
<p>The signal handling task is a non-blocking task which waits for SIGINT. If
it receives the signal it sets <code>should_exit</code> to true and finishes.</p>
<h2 id="device-mapper-event-task">device-mapper event task</h2>
<p>The device-mapper event task loops forever waiting for a device-mapper event.
On receipt of any event, it locks the <code>stratisd</code> engine, and processes the
event. It yields when waiting for a new device-mapper event or when waiting
for a lock on the engine.</p>
<h2 id="udev-event-handling-task">udev event handling task</h2>
<p>The udev event handling task uses a polling mechanism to detect udev events.
If a udev event is detected it places a message on the <code>stratisd</code> udev channel.
It reads <code>should_exit</code> after every udev event or, if no udev event has
occurred, after a designated time interval. If  <code>should_exit</code> is <code>true</code> when
read it returns immediately.</p>
<h2 id="d-bus-tasks">D-Bus Tasks</h2>
<p>The management of the D-Bus layer is handled by several cooperating tasks.
The dbus crate supplies one task, which detects D-Bus messages and places
them on its own unbounded channel. The <code>stratisd</code> tasks are the
DbusTreeHandler task, the DbusConnectionHandler task, and the
DbusUdevHandler task.</p>
<h2 id="dbustreehandler-task">DbusTreeHandler task</h2>
<p><code>stratisd</code> defines a DbusTreehandler task which updates the dbus tree and
may also handle emitting D-Bus signals. It is the unique receiver on
the <code>stratisd</code> dbus channel and the only task which obtains a write lock
on the dbus tree. It is a non-blocking task.</p>
<h2 id="dbusconnectionhandler-task">DbusConnectionHandler task</h2>
<p><code>stratisd</code> defines a DbusConnectionHandler task which spawns a
new task for every D-Bus method call. Each spawned task obtains a read
lock on the dbus tree before it begins to process the D-Bus method call,
and may also lock the engine. If it locks the engine, it blocks on the lock.
Each spawned task may place messages on the <code>stratisd</code> dbus channel. Each
task is responsible for sending replies to its D-Bus message on the D-Bus.
This is the only part of the implementation where new tasks can be spawned
during <code>stratisd</code>'s regular operation.</p>
<h2 id="dbusudevhandler-task">DbusUdevHandler task</h2>
<p><code>stratisd</code> defines a DbusUdevHandler task which removes udev event information
from the <code>stratisd</code> udev channel, allows the engine to process it, and puts
any messages that may be necessary as a result of the engine processing the
udev event on the <code>stratisd</code> dbus channel. Currently, a udev event may result in
a pool being set up; when that happens an add message must be placed on the
dbus channel for every filesystem or block device belonging to the pool,
as well as an add message for the pool itself. The DbusUdevHandler locks
the engine when processing a udev event, but does not block on the lock.</p>
<h1 id="properties-and-consequences">Properties and Consequences</h1>
<h2 id="unbounded-channels">Unbounded Channels</h2>
<p>Both the <code>stratisd</code> udev channel and the dbus channel are &quot;unbounded channels&quot;.
These &quot;unbounded&quot; channels are actually bounded, but the bound on the number
of messages allowed on the channel is the maximum value of the Rust usize type.
It is assumed that other machine limits will be encountered before the number
of messages on the channel reaches that limit. Because both channels are
unbounded, tasks do not block placing a message on the channel, sending
always succeeds.</p>
<p>We chose to make the dbus channel unbounded, as there exist two situations
where a large number of messages may be placed on the channel. When a pool
is constructed, the number of messages placed on the channel is proportional
to the number of devices in the pool. On startup, when <code>stratisd</code> sets up
a pool from its constituent devices, the number of messages is proportional
to the number of devices and to the number of filesystems that the pool
supports. We prefer to use an unbounded channel rather than to bound the
number of filesystems by the channel size.</p>
<p>Generally speaking, we expect the number of messages on the channel, except
on the occasion of pool creation or setup, to be no greater than 1; no other
action currently implemented requires more than one message to be sent to the
DbusTreeHandler. Messages will be rapidly consumed by the DbusTreeHandler, as
it is the only task that takes a write lock on the dbus tree, and a task
waiting for a write lock takes precedence over one waiting for a read lock.</p>
<p>The choice of unbounded channels also eliminates one possible source of
deadlock.</p>
<h2 id="bounded-number-of-blocking-threads">Bounded Number of Blocking Threads</h2>
<p>We have accepted, at this time, the <code>tokio</code> default for the number of blocking
threads, which is 512. Because the DbusConnectionHandler's generated tasks
are blocking, this places an upper bound on the number of
distinct D-Bus messages that can be handled concurrently. Note that it
is quite possible for 512 D-Bus messages to be handled by just one thread,
as each task may be run in sequence on a single thread if the tasks complete
rapidly.</p>
<p>We do not believe that this restriction will prove important in practice.
The dbus crate's message channel is unbounded, so D-Bus messages can not be
dropped although they may be handled very slowly if there is a backlog.
Depending on the client's configuration, this may cause the client to hang
indefinitely waiting for a response or the client may receive a message
indicating that no response was transmitted in the allotted time. However,
this situation can only arise if many messages require long-running actions
to be taken and if these messages are sent in parallel.</p>
<p>In any case, the improvement with respect to a single-threaded approach is
obvious. In the existing single threaded design, <code>stratisd</code> would be
unable to handle any other events until all the D-Bus messages had been
handled. With the multi-threaded design, udev and device-mapper events can
be handled when they arrive, interspersed with the handling of the D-Bus
messages.</p>
<h2 id="one-task-per-d-bus-message-model">One Task per D-Bus Message Model</h2>
<p>In the single-threaded design, every D-Bus message is handled completely
before handling of the next D-Bus message is begun. In our multi-threaded
design multiple D-Bus message handling tasks may be being processed at the same
time if the <code>tokio</code> scheduler allocates two message handling tasks to separate
threads.</p>
<p>Each such task must:</p>
<ol>
<li>Acquire a read lock on the dbus tree.</li>
<li>Query the tree in order to find the necessary information to call the engine
method.</li>
<li>Enter a mutex on the <code>stratisd</code> engine.</li>
<li>Operate on the <code>stratisd</code> engine.</li>
<li>Place any required messages on the dbus channel.</li>
<li>Exit the mutex.</li>
<li>Relinquish the read lock.</li>
</ol>
<p>While processing of each message will be started precisely in the sequence
in which the messages arrive, the order in which messages complete may not
be the same, because a later task may enter the engine mutex before an earlier
task.</p>
<p>The motivation for this design is obvious, although the benefits are not
yet realized in this preliminary multi-threading implementation. In future,
we expect to relax the requirement that each task have exclusive access to
the entire engine and lock only the relevant parts of the engine. With that
extension two non-interfering D-Bus commands may be run separately. The
same general advantage from this proposed enhancement will also be gained
in the matter of, for example, handling device-mapper events while
simultaneously handling a D-Bus method.</p>
<p>This change introduces a relaxation of certain properties that held in
the single-threaded case.</p>
<ol>
<li>
<p>If a D-Bus method that mutates state and requires an update to the
dbus tree is invoked the changes to the dbus tree resulting from that method
call are not visible until some time after the call has returned as updates
to the dbus tree can only occur after the method has completed. This can
be observed by a client, if the client invokes a second method immediately
after the first has returned. For example, if the client invokes the CreatePool
method and then immediately invokes the GetManagedObjects() method, some
pool object paths corresponding to the pool or its devices may not yet
be present in the tree. The opposite behavior can also be observed, for
example, if the client invokes the DestroyPool method, some object paths
belonging to the destroyed pool may still be found by a GetManagedObjects()
invocation.</p>
</li>
<li>
<p>If two D-Bus methods are invoked in separate processes, the same behaviors
described in (1) are somewhat easier to observe.</p>
</li>
<li>
<p>We believe that we have made it impossible to incorrectly update the
tree by returning rich result types from the engine methods.</p>
</li>
</ol>
<p>Given two distinct mutating D-Bus methods running in separate threads
there is a possibility of a situation rather analogous to a race-condition
arising. Two tasks may read the dbus tree, update the internal engine state,
and then send update messages on the dbus channel. It is uncertain which
task will acquire the engine mutex. This is
partially analogous to the classic race-condition where two processes read a
single variable, and then both update that variable in an undetermined order.</p>
<p>What makes this analogy only partial is the interposition of the engine,
which restricts the updates that may be requested of the DbusTreeHandler by
the DbusRequestHandler. The engine methods invoked by the D-Bus layer return
a result which sufficiently distinguishes the actions actually taken by
the engine so that conflicting updates to the dbus tree can not be
requested. Thus the updates are constrained to be correct.</p>
<p>For example, consider that two conflicting commands may be handled at the
same time: one command to delete a filesystem and the other to rename
the same filesystem. If both commands are being handled in separate threads
each will read the same data based on the filesystem object. Then, either
one may enter the engine mutex. If the rename task enters the mutex first,
it will be the first to place a message on the dbus channel. The DbusTreeHandler
will remove the rename message first and then the remove message placed
on the dbus channel after the remove request completes. Clearly,
this order of processing can not result in an error. With the other order,
the remove message will be placed on the dbus channel before the rename
occurs. But in this case, the engine method will return a result indicating
that no rename could occur, because the filesystem could not be found.
Consequently, no rename message will be put on the dbus channel, and so the
DbusTreeHandler will receive the remove message only. Thus, no incorrect
update is performed on the dbus tree.</p>
<h2 id="error-behavior">Error Behavior</h2>
<p><code>stratisd</code> exits if any task returns an error, using the same mechanism
and general procedure that it uses on receipt of SIGINT. Causes of error
may include:</p>
<ul>
<li>an error when polling for udev events</li>
<li>an error when polling for device-mapper events</li>
<li>failure to properly set up a D-Bus connection on startup</li>
<li>an error when consuming a message on one of the <code>stratisd</code> channels</li>
</ul>
<p>A properly handled error within the <code>stratisd</code> engine will not
result in the termination of any tasks. In the case of a D-Bus method call,
for example, an error result is interpreted by the D-Bus layer, and some
representation of that error is then incorporated into the message returned
on the D-Bus.</p>
<p>We have taken great care to avoid panics within <code>stratisd</code>. Nonetheless,
it is reasonable to discuss possible behavior on any panic which may
occur.</p>
<p>If one of the dynamically spawned DbusTreeHandler tasks experiences a panic
while executing, <code>stratisd</code> will not be terminated. Only the currently running
task will fail to complete.  When a new D-Bus message is received, a new task
will be spawned and will execute as usual.</p>
<p>However, a panic that occurs during the execution of a task like the
udev event handling task, of which there is only one spawned when
<code>stratisd</code> is started, will cause <code>stratisd</code> to exit.</p>
<h2 id="ensuring-a-clean-and-prompt-exit">Ensuring a Clean and Prompt Exit</h2>
<p>On SIGINT, <code>stratisd</code> should exit promptly and cleanly. This is ensured by:</p>
<ol>
<li>Having a separate signal handling task that waits on SIGINT. The <code>tokio</code>
scheduler will ensure that this task is run regularly; thus the signal
can not be ignored. Note that in the single-threaded case it is possible
for the signal handling code never to be reached.</li>
<li>Causing asynchronous tasks to terminate at their next synchronization point
when the signal handling task terminates.</li>
<li>Having the udev event handling loop check the flag set by the signal
handling task on every iteration, and terminate if the flag
is true.</li>
<li>Each distinct D-Bus method processing task is allowed to run to completion,
so that every action that it has begun can be completed.</li>
</ol>
<h1 id="statistics">Statistics</h1>
<p>Using <code>tokio</code> increases the size of the <code>stratisd</code> executable by about 1 MiB,
which at <code>stratisd</code>'s current size is an increase of approximately 20%.</p>
<h1 id="remarks">Remarks</h1>
<p>Preliminary multi-threading support will be included in the next <code>stratisd</code>
release, 2.4.0.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;multi-threading&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-3-0&#x2F;">
								Stratis 2.3.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.3.0 adds additional flexibility to its encryption support via
<a href="https://github.com/latchset/clevis">Clevis</a>.</p>
<h2 id="stratis-2-3-0">stratis 2.3.0</h2>
<p>This release extends the <code>pool unlock</code> command, and adds two new commands,
<code>pool bind</code> and <code>pool unbind</code>.</p>
<p>The <code>pool bind</code> command establishes an alternative mechanism for unlocking
a pool. The user may select either the &quot;tang&quot; mechanism, which implements
NBDE (Network-bound Disc Encryption) by means of a Tang server, or the
&quot;tpm2&quot; mechanism, which uses TPM 2.0 (Trusted Platform Module) encryption.
Binding the devices in a pool to a supplementary Clevis encryption policy does
not remove the primary encryption mechanism, which uses a key in the kernel
keyring.</p>
<p>The <code>pool unbind</code> command simply unbinds a previously added encryption
policy from all the devices in the specified pool.</p>
<p>In the <code>pool unlock</code> command it is now necessary to specify the mechanism.
Use <code>clevis</code> to make use of the Clevis unlocking policy previously
specified for the devices in the pool. Use <code>keyring</code>, to make use of the
mechanism that uses a key in the kernel keyring, which was introduced
in Stratis 2.1.0. Note that the <code>pool unlock</code> command unlocks all currently
locked pools.</p>
<h2 id="stratisd-2-3-0">stratisd 2.3.0</h2>
<p>This release introduces two D-Bus interface revisions, which differ in the
following way from the previous revisions.</p>
<p><code>org.storage.stratis2.Manager.r3</code> modifies the <code>UnlockPool</code> method to take
an additional parameter, <code>unlock_method</code>, which may be <code>keyring</code> or <code>clevis</code>.</p>
<p><code>org.storage.stratis2.pool.r3</code> adds two new method: <code>Bind</code> and <code>Unbind</code>.
The <code>Bind</code> method takes two arguments, <code>pin</code> and <code>json</code>. The <code>pin</code> argument
designates the Clevis pin as a string, and the <code>json</code> argument encodes
a Clevis configuration appropriate to the designated pin. The configuration
is a JSON object. Besides Clevis information, it may include Stratis-specific
keys that encode configuration decisions that Stratis may implement. At
present there is just one such key: <code>stratis:tang:trust_url</code>.
The <code>Unbind</code> method reverses a <code>Bind</code> action.</p>
<h2 id="remarks">Remarks</h2>
<p>The <code>Bind</code> method may be called with any Clevis pin and configuration;
we expect that any valid Clevis pin and configuration can be used to bind the
devices in a pool. However the Stratis project officially supports only the
&quot;tang&quot; and &quot;tpm2&quot; pins as those are the pins that may be designated via
<code>stratis</code>. Support for additional Clevis policies may be introduced into
<code>stratis</code> in later releases.</p>
<p>When binding a supplementary encryption policy to the devices in a pool
using Clevis, the primary key, which is the key in the kernel keyring which
was originally used to encrypt each device, must be supplied. stratisd
obtains the appropriate key from the kernel keyring in order to provide it
to the Clevis binding mechanism. The correct key must be present in the
keyring for the bind operation to succeed. It is not necessary for the user
to specify the key, stratisd obtains the necessary information from the
LUKS2 metadata on the devices in the pool.</p>
<p>In general, it is unwise to write a key consisting of arbitrary binary data
to a keyfile. An accidental newline character in the data may cause the
contents of the file to be truncated at the newline when read in one context
while all the data may be read from the file in some other context.</p>
<p>We are not aware that such a mistake would result in any error in Stratis's
operation when Stratis is used in the way that we recommend. We explicitly
acknowledge that it might be possible, through some direct interaction with
the stratisd D-Bus API, or by, e.g., setting a key in the kernel keyring
without using stratis, to manufacture a situation where stratisd could not
bind the devices in a pool, even when the correct key is set in the kernel
keyring. We would not treat such a situation as evidence of a bug in Stratis.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-3-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-2-1&#x2F;">
								Stratis 2.2.1 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.2.1 is a bug fix release. It fixes the following bugs:</p>
<ul>
<li>It was possible to cause stratisd to hang by leaving open a D-Bus
connection when setting a key in the kernel keyring.</li>
<li>stratis would pass as arguments on the D-Bus and stratisd would accept
relative, rather than absolute, path names to specify devices.</li>
<li>Pool and filesystem names that included characters that would be escaped
by udev when constructing filesystem symlinks were permitted.</li>
<li>The man page entry for the <code>key list</code> command was missing.</li>
</ul>
<p>Other general improvements were made, and several crate version requirements
were increased.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-2-1&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-2-0&#x2F;">
								Stratis 2.2.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.2.0 now places Stratis filesystem symlinks in <code>/dev/stratis</code>,
rather than <code>/stratis</code>. Stratis creates and maintains the symlinks by means
of udev rules, rather than directly via stratisd as previously.
The <code>/stratis</code> directory is neither created nor used by stratisd 2.2.0.</p>
<p>This release places management of the terminal setting for interactive
encryption-key entry in stratisd rather than in stratis-cli.</p>
<p>This release also includes enhancements to the stratisd D-Bus interface,
various bug fixes, and a change in the stratisd CLI specification for
log levels.</p>
<h2 id="stratisd-2-2-0">stratisd 2.2.0</h2>
<p>This release creates and maintains Stratis filesystem symlinks in
<code>/dev/stratis</code> by means of udev rules. It includes a small Rust script,
<code>stratis_uuids_to_names</code> which is invoked by the Stratis udev rule which
sets the Stratis filesystem symlinks.</p>
<p>In the case where stratisd is updated in place, some filesystem symlinks
may remain in <code>/stratis</code>. This release includes a shell script,
<code>stratis_migrate_symlinks.sh</code> which may be used to clean up the <code>/stratis</code>
directory and ensure that the correct symlinks exist in <code>/dev/stratis</code>. The
script removes the <code>/stratis</code> directory once it has completed without error.
The shell script relies on a small Rust script, <code>stratis_dbusquery_version</code>
which is included with this version of stratisd.</p>
<p>This release also extends the D-Bus interface in a few ways:</p>
<ul>
<li>It sends <code>org.freedesktop.DBus.ObjectManager.InterfacesAdded</code>and
<code>org.freedesktop.DBus.ObjectManager.InterfacesRemoved</code> signals on the
D-Bus whenever a D-Bus object is added to or removed from the D-Bus
interface.</li>
<li>It adds a new D-Bus property, <code>PhysicalPath</code>, for the 
<code>org.storage.stratis2.blockdev.r2</code> interface. This property is
principally useful for encrypted Stratis block devices; it identifies
the block device on which the Stratis LUKS2 metadata resides.</li>
<li>It adds a new key, <code>LockedPools</code>, to the
<code>org.storage.stratis2.FetchProperties.r2</code> interface for objects that
implement the <code>org.storage.stratis2.Manager</code> interface. This key
returns a D-Bus object that maps the UUIDs of locked pools to their
corresponding key descriptions.</li>
</ul>
<p>Please consult the D-Bus API Reference for the precise D-Bus specification.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-2-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-2-1-1&#x2F;">
								stratis-cli 2.1.1 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>stratis-cli 2.1.1 fixes a bug where if one encrypted pool could not be
unlocked, execution terminated, and no attempt was made to unlock any other
pools that might need to be unlocked (<a href="https://github.com/stratis-storage/stratis-cli/issues/618">stratis issue 618</a>).</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-2-1-1&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;katacoda-tutorial&#x2F;">
								Katacoda Tutorial
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>We would like to thank Red Hat for hosting a Katacoda tutorial for Stratis at
<a href="https://lab.redhat.com/stratis">lab.redhat.com/stratis</a>. We hope that the tutorial will provide an easy and
pleasant introduction to Stratis for new users.</p>
<p>Please note that the tutorial does not include the latest work on encryption,
as it makes use of a prior version of Stratis, 2.0.0.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;katacoda-tutorial&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-1-0&#x2F;">
								Stratis 2.1.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.1.0 introduces support for encryption.</p>
<p>It supports per-pool encryption of the devices that form a pool's data
tier. A pool may be encrypted, or its constituent encrypted devices may
be activated, by means of a key stored in the kernel keyring.</p>
<h2 id="stratisd-2-1-0">stratisd 2.1.0</h2>
<p>This release implements encryption support and adds several new D-Bus
interfaces to administer or monitor that support.</p>
<p>It implements encryption support in the following way:</p>
<ul>
<li>A single instance of stratisd can support both encrypted and unencrypted
pools.</li>
<li>The choice to encrypt a pool must be made at the time a pool is created.</li>
<li>At present, the use of a cache and of encryption are mutually exclusive;
if the pool is created with encryption enabled, then it is not possible
to create a cache.</li>
<li>Each pool may be encrypted by means of a key in the kernel keyring; each
encrypted pool may make use of a different key, but all devices in a pool
are encrypted with a single key.</li>
<li>Any additional devices that are added to an encrypted pool's data tier
will be encrypted using the key that was specified when the pool was
initialized.</li>
</ul>
<p>stratisd 2.1.0 supplies several new D-Bus interfaces:</p>
<ul>
<li><code>org.storage.stratis2.manager.r1</code>: This interface supplies an
extended <code>CreatePool</code> method, to support an optional argument for
encryption. In addition, it supplies a number of method for key
management.</li>
<li><code>org.storage.stratis2.pool.r1</code>: This interface supports explicit
initialization of a cache tier. Previously, a cache was initialized as
a side-effect of the addition of the first device to the cache tier.
It also supports the new <code>Encrypted</code> property.</li>
<li><code>org.storage.stratis2.FetchProperties.r1</code>: This interface supports an
additional <code>HasCache</code> property.</li>
<li><code>org.storage.stratis2.Report.r1</code>: This interface supports a set of
ad-hoc reports about Stratis. The interface is unstable; the names by
which the reports can be accesed are not guaranteed to remain stable,
and the format of any report is only guaranteed to be valid JSON.</li>
</ul>
<p>Please consult the D-Bus API Reference for the precise D-Bus specification.</p>
<p>The following are significant implementation details:</p>
<ul>
<li>Each block device in an encrypted pool's data tier is encrypted with a
distinct, randomly chosen MEK (Media Encryption Key) on initialization.</li>
<li>All devices belonging to a single encrypted pool share a single passphrase,
supplied via the kernel keyring.</li>
<li>The release requires cryptsetup version 2.3.</li>
</ul>
<p>We would like to thank our external contributor GuillaumeGomez for further
work on metadata refactoring (<a href="https://github.com/stratis-storage/stratisd/issues/1573">stratisd issue 1573</a>).</p>
<h2 id="stratis-cli-2-1-0">stratis-cli 2.1.0</h2>
<p>This release requires stratisd 2.1.0. The user will observe the following
changes:</p>
<ul>
<li>The <code>pool create</code> command has been extended to allow encryption.</li>
<li>There is a new <code>pool init_cache</code> command, for initializing a cache.</li>
<li>There is a new subcommand, <code>key</code>, for key management tasks.</li>
<li>There is a new subcommand, <code>report</code>, which allows the display of certain
reports generated by stratisd.</li>
<li>The output of <code>pool list</code> now includes a <code>Properties</code> column; each
entry in the column is a string encoding the following properties of the
pool:
<ul>
<li>whether or not it has a cache</li>
<li>whether or not it is encrypted</li>
</ul>
</li>
</ul>
<p>All commands now verify that stratis is communicating with a compatible
version of stratisd and will fail with an appropriate error if stratisd is
found to have an incompatible version.</p>
<h2 id="usage">Usage</h2>
<p>To create an encrypted pool, a user must first ensure that a key is placed
in the kernel keyring. We strongly encourage using the commands available
via the stratis <code>key</code> subcommand for this task. This key, which is secret,
has a corresponding key description, which is public.</p>
<p>An encrypted pool is then created by specifying the key description
when using the <code>pool create</code> command.</p>
<p>It is necessary that the correct key and corresponding key description be set
in the kernel keyring in order to set up a previously encrypted pool. Setting
up a previously encrypted pool requires an explicit <code>pool unlock</code> command from
the user. This command will attempt to unlock the devices belonging to any
previously encrypted pool; it can only unlock all devices if a key for every
encrypted pool is in the keyring. Once the devices belonging to a previously
encrypted pool have been unlocked, the pool will be set up, and can be used in
exactly the same manner as an unencrypted pool.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-1-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratisd-release-notes-2-0-1&#x2F;">
								stratisd 2.0.1 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>stratisd 2.0.1 contains a number of internal improvements as well as
enhanced logging.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratisd-release-notes-2-0-1&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-2-0-1&#x2F;">
								stratis-cli 2.0.1 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>stratis-cli 2.0.1 contains a number of internal improvements as well as
some improvements to certain error messages.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-2-0-1&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;cryptsetup&#x2F;">
								Cryptsetup Rust bindings release
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>John Baublitz, Stratis Team</em></p>
<p>One major focus in the Stratis project recently has been adding an encryption layer
for data in Stratis pools. Cryptsetup provides a library backend for programmatically
setting up device encryption, so we decided to write Rust bindings to access the
existing Cryptsetup functionality in Rust.</p>
<p>While designing the bindings, we took every opportunity to make use of Rust's
type system, leveraging features like reference lifetimes and type parameters
to ensure that as much of our public API as possible can be validated by the
compiler.</p>
<p>Though these bindings were designed with Stratis in mind, it is intended
to be general-purpose and so we encourage others to try it out. The license
is MPLv2, but it becomes effectively GPL when linked with libcryptsetup.
As a result, any project using our bindings will also need to be GPL or
GPL-compatible.</p>
<p>If you're interested in seeing more, you can find <a href="https://github.com/stratis-storage/libcryptsetup-rs">the repository here</a>.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;cryptsetup&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-0-0&#x2F;">
								Stratis 2.0.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>Stratis 2.0 is a significant update for both the daemon and the CLI. The
changes to the daemon are covered first, followed by the changes to the
CLI.</p>
<h2 id="stratisd-2-0-0">stratisd 2.0.0</h2>
<p>This release makes the D-Bus API more robust, reliable, predictable, and
extensible. There are several significant changes:</p>
<ul>
<li>
<p>The set of D-Bus properties has been reduced to a core set of fundamental
and stable properties. Other filesystem, pool, or block devices properties are
now obtainable via methods in the <code>FetchProperties</code> interface. This change
increases the robustness of the D-Bus interface to failures occurring in any
particular pool, filesystem, or block device, and decreases the computational
cost of most operations requested by the Stratis CLI. Several properties,
formerly returned as D-Bus properties, are now unavailable by means of the
D-Bus. In every case, the reason for removing the property was that it did not
represent a well-defined value. See <a href="https://github.com/stratis-storage/project/issues/52">project issue 52</a> for further details.</p>
</li>
<li>
<p>All D-Bus method calls are idempotent. This should make writing scripts
using the D-Bus API much simpler and make reasoning about the behavior
of the engine more straightforward. Henceforth, we will treat as a bug any
non-idempotent behavior in the D-Bus API. See <a href="https://github.com/stratis-storage/project/issues/51">project issue 51</a> for further
details.</p>
</li>
<li>
<p>All D-Bus size values are now returned in bytes. Again, this should make
writing scripts against the D-Bus more straightforward, since it will be
unnecessary for the script writer to change their interpretation of the number
returned on the D-Bus depending on the value that it represents. See
<a href="https://github.com/stratis-storage/stratisd/issues/1243">stratisd issue 1243</a> for further details.</p>
</li>
</ul>
<p>Future enhancements to the D-Bus API will be implemented by means of
additional versioned interfaces.</p>
<p>Please consult the D-Bus API Reference for the precise D-Bus specification.</p>
<h2 id="stratis-cli-2-0-0">stratis-cli 2.0.0</h2>
<p>This release requires stratisd 2.0.0. The user will observe the following
significant improvements:</p>
<ul>
<li>
<p>The CLI is significantly more robust. Previously, there was a category of
error conditions in pools, filesystems, and block devices that would make the
CLI virtually unusable; this problem has now been entirely resolved. See
<a href="https://github.com/stratis-storage/project/issues/52">project issue 52</a> for further details.</p>
</li>
<li>
<p>The CLI now reports errors consistently in conditions where a human user
would generally expect an error to be reported. Previously, many commands in
the CLI were idempotent, to facilitate scripting. Now there is a clear
distinction between the CLI behavior and the stratisd D-Bus API behavior: the
CLI behavior is designed strictly according to the expectations of a human
user, the stratisd D-Bus API is the programmable interface. See
<a href="https://github.com/stratis-storage/project/issues/51">project issue 51</a> for further details.</p>
</li>
</ul>
<p>As always, anyone wishing to implement a program that uses Stratis for
storage management is strongly advised to make use of the stratisd D-Bus API
rather than the CLI.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-2-0-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-1-1-0&#x2F;">
								stratis-cli 1.1.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>With this release stratis now recognizes an environment variable,
<code>STRATIS_DBUS_TIMEOUT</code>. This environment variable controls the timeout for
any individual D-Bus call that stratis makes. You may want to set it to a
higher value than the default, which is 120 seconds, if you are running
tests or otherwise scripting via stratis, and wish to avoid erroneous errors
resulting from slow operations in your testing environment. See
<a href="https://github.com/stratis-storage/stratis-cli/issues/252">stratis-cli issue 252</a> for further details.</p>
<p>This release also introduces simplified and more complete error-reporting.
For stratis, it constitutes an error if any command issued results in a
Python stack trace. If you experience any such incident, please
report it in a GitHub issue, including the full stack trace, and
circumstances that led up to the incident.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-cli-release-notes-1-1-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratisd-release-notes-1-0-6&#x2F;">
								stratisd 1.0.6 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p><em>mulhern, Stratis Team</em></p>
<p>This release includes one significant bug fix and a substantial refactoring.</p>
<p>The bug was caused by an inconsistency in the metadata handling which led to
a failure to properly update the Stratis metadata if stratisd was restarted
in an environment where the system clock indicated a time earlier than when
it had previously been running. See <a href="https://github.com/stratis-storage/stratisd/issues/1509">stratisd issue 1509</a> for further
details.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratisd-release-notes-1-0-6&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-1-0-0&#x2F;">
								Stratis 1.0 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p>Friday September 28, 2018</p>
<h1 id="new-features">New Features</h1>
<h2 id="initial-stable-stratis-release">Initial Stable Stratis Release</h2>
<p>Stratis is a Linux local storage management tool that aims to enable easy use of advanced storage features such as thin provisioning, snapshots, and pool-based management and monitoring.</p>
<p>After two years of development, Stratis 1.0 has stabilized its on-disk metadata format and command-line interface, and is ready for more widespread testing and evaluation by potential users. Stratis is implemented as a daemon  <code>stratisd</code>  as well as a command-line configuration tool called stratis, and works with Linux kernel versions 4.14 and up.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-1-0-0&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                      <div class="post">
						<article class="post">
							<h1 class="post-title">
							  <a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-0-5&#x2F;">
								Stratis 0.5 Release Notes
							  </a>
							</h1>
							<div class="post__summary">
								<p>March 8, 2018</p>
<p>This release is suitable for developers and early testers. It should not be
used with valuable data, and pools created with this release will not be
supported in Stratis 1.0, due to upcoming on-disk format changes.</p>

							</div>
							<div class="read-more">
								<a href="https:&#x2F;&#x2F;stratis-storage.github.io&#x2F;stratis-release-notes-0-5&#x2F;">Read more...</a>
							</div>
						</article>
						
                      </div>
                    
                </div>
            
        </div>

    </body>

</html>
